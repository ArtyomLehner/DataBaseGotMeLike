-- PROCEDURE: lehner_02272.get_services_report(integer)

-- DROP PROCEDURE IF EXISTS lehner_02272.get_services_report(integer);

CREATE OR REPLACE PROCEDURE lehner_02272.get_services_report(
	IN hotel_id_param integer DEFAULT NULL::integer)
LANGUAGE 'plpgsql'
AS $BODY$
BEGIN
    IF hotel_id_param IS NULL THEN
        -- Все отели
        SELECT * FROM lehner_02272.hotel_services_report
        ORDER BY hotel_name, total_revenue DESC;
    ELSE
        -- Конкретный отель
        SELECT * FROM lehner_02272.hotel_services_report
        WHERE hotel_name = (SELECT name FROM lehner_02272.hotels WHERE id = hotel_id_param)
        ORDER BY total_revenue DESC;
    END IF;
END;
$BODY$;
ALTER PROCEDURE lehner_02272.get_services_report(integer)
    OWNER TO student;
