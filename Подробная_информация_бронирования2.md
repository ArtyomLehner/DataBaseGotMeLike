-- PROCEDURE: lehner_02272.get_detailed_booking_report(date, date, character varying)

-- DROP PROCEDURE IF EXISTS lehner_02272.get_detailed_booking_report(date, date, character varying);

CREATE OR REPLACE PROCEDURE lehner_02272.get_detailed_booking_report(
	IN start_date_param date DEFAULT NULL::date,
	IN end_date_param date DEFAULT NULL::date,
	IN status_param character varying DEFAULT NULL::character varying)
LANGUAGE 'plpgsql'
AS $BODY$
BEGIN
    IF start_date_param IS NULL AND end_date_param IS NULL AND status_param IS NULL THEN
        -- Все бронирования
        SELECT * FROM lehner_02272.detailed_booking_report;
    ELSE
        -- Фильтрация по параметрам
        SELECT * FROM lehner_02272.detailed_booking_report
        WHERE 
            (start_date_param IS NULL OR start_date >= start_date_param) AND
            (end_date_param IS NULL OR end_date <= end_date_param) AND
            (status_param IS NULL OR status = status_param)
        ORDER BY start_date DESC, booking_id;
    END IF;
END;
$BODY$;
ALTER PROCEDURE lehner_02272.get_detailed_booking_report(date, date, character varying)
    OWNER TO student;