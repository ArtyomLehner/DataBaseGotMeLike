-- Table: lehner_02272.guests

-- DROP TABLE IF EXISTS lehner_02272.guests;

CREATE TABLE IF NOT EXISTS lehner_02272.guests
(
    id integer NOT NULL DEFAULT nextval('lehner_02272.guests_id_seq'::regclass),
    first_name character varying(50) COLLATE pg_catalog."default" NOT NULL,
    last_name character varying(50) COLLATE pg_catalog."default" NOT NULL,
    passport character varying(20) COLLATE pg_catalog."default" NOT NULL,
    phone character varying(20) COLLATE pg_catalog."default",
    email character varying(100) COLLATE pg_catalog."default",
    birth_date date,
    created timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT guests_pkey PRIMARY KEY (id),
    CONSTRAINT guests_passport_key UNIQUE (passport)
)

TABLESPACE pg_default;

ALTER TABLE IF EXISTS lehner_02272.guests
    OWNER to student;

-- Trigger: trigger_audit_guests

-- DROP TRIGGER IF EXISTS trigger_audit_guests ON lehner_02272.guests;

CREATE OR REPLACE TRIGGER trigger_audit_guests
    AFTER INSERT OR DELETE OR UPDATE 
    ON lehner_02272.guests
    FOR EACH ROW
    EXECUTE FUNCTION lehner_02272.audit_trigger_function();

-- Trigger: trigger_cascade_delete_guest

-- DROP TRIGGER IF EXISTS trigger_cascade_delete_guest ON lehner_02272.guests;

CREATE OR REPLACE TRIGGER trigger_cascade_delete_guest
    BEFORE DELETE
    ON lehner_02272.guests
    FOR EACH ROW
    EXECUTE FUNCTION lehner_02272.cascade_delete_guest();