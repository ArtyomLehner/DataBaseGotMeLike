-- Table: lehner_02272.booking_services

-- DROP TABLE IF EXISTS lehner_02272.booking_services;

CREATE TABLE IF NOT EXISTS lehner_02272.booking_services
(
    id integer NOT NULL DEFAULT nextval('lehner_02272.booking_services_id_seq'::regclass),
    booking_id integer NOT NULL,
    service_id integer NOT NULL,
    quantity integer DEFAULT 1,
    service_date date DEFAULT CURRENT_DATE,
    CONSTRAINT booking_services_pkey PRIMARY KEY (id),
    CONSTRAINT booking_services_booking_id_service_id_service_date_key UNIQUE (booking_id, service_id, service_date),
    CONSTRAINT booking_services_booking_id_fkey FOREIGN KEY (booking_id)
        REFERENCES lehner_02272.bookings (id) MATCH SIMPLE
        ON UPDATE NO ACTION
        ON DELETE CASCADE,
    CONSTRAINT booking_services_service_id_fkey FOREIGN KEY (service_id)
        REFERENCES lehner_02272.services (id) MATCH SIMPLE
        ON UPDATE NO ACTION
        ON DELETE CASCADE,
    CONSTRAINT booking_services_quantity_check CHECK (quantity > 0)
)

TABLESPACE pg_default;

ALTER TABLE IF EXISTS lehner_02272.booking_services
    OWNER to student;
-- Index: idx_booking_services_fast

-- DROP INDEX IF EXISTS lehner_02272.idx_booking_services_fast;

CREATE INDEX IF NOT EXISTS idx_booking_services_fast
    ON lehner_02272.booking_services USING btree
    (booking_id ASC NULLS LAST)
    INCLUDE(service_id, quantity)
    WITH (fillfactor=100, deduplicate_items=True)
    TABLESPACE pg_default;