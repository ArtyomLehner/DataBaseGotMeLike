-- FUNCTION: lehner_02272.get_booking_details(integer)

-- DROP FUNCTION IF EXISTS lehner_02272.get_booking_details(integer);

CREATE OR REPLACE FUNCTION lehner_02272.get_booking_details(
	booking_id_param integer)
    RETURNS TABLE(booking_id integer, guest_name text, hotel_name character varying, room_number character varying, room_type text, start_date date, end_date date, total_amount numeric, status character varying) 
    LANGUAGE 'plpgsql'
    COST 100
    VOLATILE PARALLEL UNSAFE
    ROWS 1000

AS $BODY$
BEGIN
    RETURN QUERY
    SELECT 
        b.id AS booking_id,
        g.first_name || ' ' || g.last_name AS guest_name,
        h.name AS hotel_name,
        r.number AS room_number,
        rt.class || ' - ' || rt.type AS room_type,
        b.start_date,
        b.end_date,
        b.amount AS total_amount,
        b.status
    FROM lehner_02272.bookings b
    JOIN lehner_02272.guests g ON b.guest_id = g.id
    JOIN lehner_02272.rooms r ON b.room_id = r.id
    JOIN lehner_02272.hotels h ON r.hotel_id = h.id
    JOIN lehner_02272.room_type rt ON r.type_id = rt.id
    WHERE b.id = booking_id_param;
END;
$BODY$;

ALTER FUNCTION lehner_02272.get_booking_details(integer)
    OWNER TO student;
