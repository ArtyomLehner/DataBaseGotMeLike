-- Table: lehner_02272.audit_log

-- DROP TABLE IF EXISTS lehner_02272.audit_log;

CREATE TABLE IF NOT EXISTS lehner_02272.audit_log
(
    id integer NOT NULL DEFAULT nextval('lehner_02272.audit_log_id_seq'::regclass),
    table_name character varying(100) COLLATE pg_catalog."default" NOT NULL,
    operation character varying(10) COLLATE pg_catalog."default" NOT NULL,
    record_id integer,
    old_data jsonb,
    new_data jsonb,
    changed_fields text[] COLLATE pg_catalog."default",
    changed_by character varying(100) COLLATE pg_catalog."default" DEFAULT CURRENT_USER,
    changed_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    ip_address inet,
    application_name character varying(100) COLLATE pg_catalog."default",
    CONSTRAINT audit_log_pkey PRIMARY KEY (id),
    CONSTRAINT audit_log_operation_check CHECK (operation::text = ANY (ARRAY['INSERT'::character varying, 'UPDATE'::character varying, 'DELETE'::character varying]::text[]))
)

TABLESPACE pg_default;

ALTER TABLE IF EXISTS lehner_02272.audit_log
    OWNER to student;
-- Index: idx_audit_log_operation

-- DROP INDEX IF EXISTS lehner_02272.idx_audit_log_operation;

CREATE INDEX IF NOT EXISTS idx_audit_log_operation
    ON lehner_02272.audit_log USING btree
    (operation COLLATE pg_catalog."default" ASC NULLS LAST, changed_at ASC NULLS LAST)
    WITH (fillfactor=100, deduplicate_items=True)
    TABLESPACE pg_default;
-- Index: idx_audit_log_record_id

-- DROP INDEX IF EXISTS lehner_02272.idx_audit_log_record_id;

CREATE INDEX IF NOT EXISTS idx_audit_log_record_id
    ON lehner_02272.audit_log USING btree
    (record_id ASC NULLS LAST)
    WITH (fillfactor=100, deduplicate_items=True)
    TABLESPACE pg_default;
-- Index: idx_audit_log_table

-- DROP INDEX IF EXISTS lehner_02272.idx_audit_log_table;

CREATE INDEX IF NOT EXISTS idx_audit_log_table
    ON lehner_02272.audit_log USING btree
    (table_name COLLATE pg_catalog."default" ASC NULLS LAST, changed_at ASC NULLS LAST)
    WITH (fillfactor=100, deduplicate_items=True)
    TABLESPACE pg_default;