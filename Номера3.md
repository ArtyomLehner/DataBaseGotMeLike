-- Table: lehner_02272.rooms

-- DROP TABLE IF EXISTS lehner_02272.rooms;

CREATE TABLE IF NOT EXISTS lehner_02272.rooms
(
    id integer NOT NULL DEFAULT nextval('lehner_02272.rooms_id_seq'::regclass),
    hotel_id integer NOT NULL,
    type_id integer NOT NULL,
    "number" character varying(10) COLLATE pg_catalog."default" NOT NULL,
    floor integer NOT NULL,
    balcony boolean DEFAULT false,
    view boolean DEFAULT false,
    smoking boolean DEFAULT false,
    status character varying(20) COLLATE pg_catalog."default" DEFAULT 'available'::character varying,
    CONSTRAINT rooms_pkey PRIMARY KEY (id),
    CONSTRAINT rooms_hotel_id_fkey FOREIGN KEY (hotel_id)
        REFERENCES lehner_02272.hotels (id) MATCH SIMPLE
        ON UPDATE NO ACTION
        ON DELETE CASCADE,
    CONSTRAINT rooms_type_id_fkey FOREIGN KEY (type_id)
        REFERENCES lehner_02272.room_type (id) MATCH SIMPLE
        ON UPDATE NO ACTION
        ON DELETE CASCADE,
    CONSTRAINT rooms_floor_check CHECK (floor >= 1),
    CONSTRAINT rooms_status_check CHECK (status::text = ANY (ARRAY['available'::character varying, 'occupied'::character varying, 'maintenance'::character varying]::text[]))
)

TABLESPACE pg_default;

ALTER TABLE IF EXISTS lehner_02272.rooms
    OWNER to student;
-- Index: idx_rooms_hotel_join

-- DROP INDEX IF EXISTS lehner_02272.idx_rooms_hotel_join;

CREATE INDEX IF NOT EXISTS idx_rooms_hotel_join
    ON lehner_02272.rooms USING btree
    (id ASC NULLS LAST, hotel_id ASC NULLS LAST)
    INCLUDE(balcony, view)
    WITH (fillfactor=100, deduplicate_items=True)
    TABLESPACE pg_default;

-- Trigger: trigger_audit_rooms

-- DROP TRIGGER IF EXISTS trigger_audit_rooms ON lehner_02272.rooms;

CREATE OR REPLACE TRIGGER trigger_audit_rooms
    AFTER INSERT OR DELETE OR UPDATE 
    ON lehner_02272.rooms
    FOR EACH ROW
    EXECUTE FUNCTION lehner_02272.audit_trigger_function();