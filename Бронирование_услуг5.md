-- FUNCTION: lehner_02272.get_booking_services(integer)

-- DROP FUNCTION IF EXISTS lehner_02272.get_booking_services(integer);

CREATE OR REPLACE FUNCTION lehner_02272.get_booking_services(
	booking_id_param integer)
    RETURNS TABLE(service_name character varying, quantity integer, unit_price numeric, service_total numeric, service_date date) 
    LANGUAGE 'plpgsql'
    COST 100
    VOLATILE PARALLEL UNSAFE
    ROWS 1000

AS $BODY$
BEGIN
    RETURN QUERY
    SELECT 
        s.name AS service_name,
        bs.quantity,
        s.price AS unit_price,
        (bs.quantity * s.price) AS service_total,
        bs.service_date
    FROM lehner_02272.booking_services bs
    JOIN lehner_02272.services s ON bs.service_id = s.id
    WHERE bs.booking_id = booking_id_param
    ORDER BY bs.service_date;
END;
$BODY$;

ALTER FUNCTION lehner_02272.get_booking_services(integer)
    OWNER TO student;
